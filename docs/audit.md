# Аудит правил, реализации и UX мини-приложения «Бура»

## Подход
- Изучены серверные правила и алгоритмы (`backend/game.py`, `backend/main.py`).
- Проверены модельные классы (`backend/models.py`) и интеграция через WebSocket/REST.
- Просмотрен фронтенд (React/Vite) с упором на экраны лобби, создания стола и отображения партии.
- Запущены автоматические проверки: `pytest` для бэкенда и `npm run build` для фронтенда.

## Соответствие правил и алгоритмов
### Совпадения
- Розыгрыш взятки: владелец меняется только когда соперник полностью перебивает набор лидера; частичное перекрытие помечается как `partial` и не меняет владельца, после чего карты уходят победителю и в сброс.【F:backend/game.py†L500-L586】
- Проверка 4-карточных стартовых комбинаций совпадает с описанными в правилах вариантами (одна масть или сочетания тузов/десяток).【F:backend/game.py†L438-L455】【F:frontend/src/components/GameRules.tsx†L28-L38】
- Комбинации («Бура», «Молодка», «Москва», «4 конца») доступны до первого хода раунда и не дают прямых очков, что отражено и в коде, и в тексте правил.【F:backend/game.py†L388-L436】【F:frontend/src/components/GameRules.tsx†L45-L54】
- Подсчёт штрафов соответствует описанию: лидеры получают 0, 31 очко даёт 2 штрафа, остальные — 4, ноль очков — 6.【F:backend/game.py†L587-L604】【F:frontend/src/components/GameRules.tsx†L57-L64】

### Найденные несоответствия или потенциальные вводящие в заблуждение места
1. **Вариант «С семёрками»**. В описании варианта говорится об «экспериментальных правилах с семёрками», но алгоритм использует одну и ту же 36-карточную колоду для всех столов и не содержит специальной логики для семёрок.【F:backend/game.py†L26-L78】【F:backend/game.py†L785-L799】 Рекомендация: либо убрать вариант, либо уточнить описание/добавить реальные изменения правил.
2. **Отображение частичного перебивания**. В коде сохраняется тип исхода `partial`, чтобы фронтенд мог подсветить частичный успех, но текст правил ранее утверждал, что «перебить частично нельзя». Формулировка в правилах обновлена, однако UI по-прежнему не объясняет, что частичный ответ считается вынужденным сбросом. Можно добавить всплывающую подсказку или визуальное различие на столе.

## Проверка корректности кода
- Бэкенд: все 16 тестов (`pytest`) проходят, покрывая ключевые сценарии розыгрыша, объявлений и добора карт.【47d7ac†L1-L6】
- Фронтенд: `npm run build` успешно собирает проект, что подтверждает корректность TypeScript/JSX-кода и конфигурации Vite.【88f12a†L1-L6】

## UX-анализ
### Создание и настройка стола
- Форма создания позволяет выбрать имя, предел игроков (2/3/4), видимость сброса, доступность комбо «4 конца» и таймер хода; рядом отображается сводка выбранных настроек, что облегчает проверку перед созданием.【F:frontend/src/components/CreateTableForm.tsx†L24-L158】
- Сообщения об ошибках продублированы баннером и `alert`, что помогает в Telegram-веб-контексте, где уведомления могут теряться.【F:frontend/src/components/CreateTableForm.tsx†L48-L58】

### Поиск и подключение к партиям
- Экран лобби поддерживает живое обновление через WebSocket и периодический поллинг, что снижает риск устаревшего списка комнат.【F:frontend/src/components/Lobby.tsx†L22-L55】
- Доступен поиск по ID комнаты и карточки с индикаторами количества игроков, статуса и параметров стола; кнопка подключиться блокируется, если лимит игроков достигнут.【F:frontend/src/components/Lobby.tsx†L84-L137】

### Ход партии
- Основной экран отображает настройки стола, текущие объявления и таймеры ходов, предоставляет drag-and-drop и клики для выкладки карт (логика в `Hand`/`TableView`).【F:frontend/src/App.tsx†L92-L209】
- Табло (`ScoreBoard`) показывает количество победных раундов и очки за взятые карты, что облегчает отслеживание прогресса без обращения к внешним записям.【F:frontend/src/App.tsx†L148-L205】

### Возможные UX-улучшения
- Кнопка стартa игры подписана «Start», тогда как остальная локализация русская; стоит заменить на «Старт».【F:frontend/src/components/StartGame.tsx†L4-L24】
- Нет явного отображения, сколько очков дают объявленные комбинации (они не дают очков, но игрокам может понадобиться пояснение/история в интерфейсе).
- Для партий на 4 игрока на столе появляется много карт; стоит рассмотреть масштабирование стола или компактный режим (в `TableView` пока фиксированная компоновка).

## Рекомендации
1. Уточнить или реализовать реальные отличия варианта «С семёрками», чтобы игроки понимали, чем он отличается от классики.
2. Добавить пояснения в UI о том, что частичное перебивание не меняет владельца взятки, чтобы игроки не считали это ошибкой.
3. Завершить локализацию (кнопка «Start» и возможные технические сообщения) для единообразия.
4. Подумать о визуальных подсказках для больших столов (3–4 игрока), например, компактная колода сбоку или индикаторы активного игрока.

